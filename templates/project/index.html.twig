{% extends 'base.html.twig' %}

{% block title %}Mes Projets - TaskFlow
{% endblock %}

{% block body %}
	<div class="container-fluid">
		<div class="row mb-4">
			<div class="col-12">
				<div class="d-flex justify-content-between align-items-center">
					<div>
						<h1 class="h3 mb-2">üóÇÔ∏è Mes Projets</h1>
						<p class="text-muted mb-0">G√©rez et organisez tous vos projets</p>
					</div>
					<div>
						<a href="{{ path('project_new') }}" class="btn btn-primary">
							<i class="fas fa-plus me-2"></i>Nouveau projet
						</a>
					</div>
				</div>
			</div>
		</div>

		{% if projects is empty %}
			<div class="row justify-content-center">
				<div class="col-md-8 col-lg-6">
					<div class="text-center py-5">
						<div class="mb-4">
							<i class="fas fa-folder-open fa-5x text-muted"></i>
						</div>
						<h4 class="mb-3">Aucun projet pour le moment</h4>
						<p class="text-muted mb-4">
							Commencez par cr√©er votre premier projet pour organiser vos t√¢ches
							et suivre votre progression.
						</p>
						<a href="{{ path('project_new') }}" class="btn btn-primary">
							<i class="fas fa-plus me-2"></i>Cr√©er un projet
						</a>
					</div>
				</div>
			</div>
		{% else %}
			<div class="row">
				{% for project in projects %}
					<div class="col-md-6 col-lg-4 col-xl-3 mb-4">
						<div class="card h-100 project-card shadow-sm">
							<div class="card-body d-flex flex-column">
								<h5 class="card-title mb-3 d-flex justify-content-between align-items-center">
									<a href="{{ path('project_show', {id: project.id}) }}" class="stretched-link text-decoration-none text-dark">{{ project.title }}</a>
								</h5>
								
								{% if project.description %}
									<div class="card border-0 bg-light mb-3">
										<div class="card-body p-3">
											<h6 class="text-dark mb-2">
												<i class="fas fa-info-circle me-2 text-primary"></i>
												Description du projet
											</h6>
											<p class="mb-0 text-muted text-break small" style="word-wrap: break-word;">{{ project.description|nl2br }}</p>
										</div>
									</div>
								{% endif %}
								
								<ul class="list-unstyled d-flex flex-wrap gap-3 mt-auto">
									<li>
										<i class="fas fa-tasks me-1 text-primary"></i>
										{{ project.tasksCount }}
										t√¢ches
									</li>
									<li>
										<i class="fas fa-check-circle me-1 text-success"></i>
										{{ project.completedTasksCount }}
										termin√©es
									</li>
									<li>
										<i class="fas fa-spinner me-1 text-warning"></i>
										{{ project.inProgressTasksCount }}
										en cours
									</li>
								</ul>
								<div class="progress mt-3" style="height: 5px;">
									<div class="progress-bar bg-success" role="progressbar" style="width: {{ project.progressPercentage }}%;" aria-valuenow="{{ project.progressPercentage }}" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
								<small class="text-muted mt-2">{{ project.progressPercentage }}% de progression</small>
							</div>
						</div>
					</div>

					<div class="modal fade" id="deleteModal{{ project.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ project.id }}" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="deleteModalLabel{{ project.id }}">
										<i class="fas fa-exclamation-triangle text-danger me-2"></i>
										Confirmer la suppression
									</h5>
									<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
								</div>
								<div class="modal-body">
									<p>√ätes-vous s√ªr de vouloir supprimer le projet
										<strong>"{{ project.title }}"</strong>
										?</p>
									<div class="alert alert-warning">
										<i class="fas fa-exclamation-triangle me-2"></i>
										<strong>Attention :</strong>
										Cette action supprimera d√©finitivement le projet
										et toutes ses t√¢ches ({{ project.tasksCount }}
										t√¢che(s)).
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
									<form method="post" action="{{ path('project_delete', {id: project.id}) }}" class="d-inline">
										<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ project.id) }}">
										<button type="submit" class="btn btn-danger">
											<i class="fas fa-trash me-2"></i>Supprimer d√©finitivement
										</button>
									</form>
								</div>
							</div>
						</div>
					</div>
				{% endfor %}
			</div>
		{% endif %}
	</div>
{% endblock %}