{% extends 'base.html.twig' %}

{% block title %}Mon Profil - TaskFlow
{% endblock %}

{% block body %}
	<div class="container">
		<div class="row">
			<div class="col-lg-8 mx-auto">
				<div class="card border-0 shadow-sm">
					<div class="card-header bg-primary text-white">
						<h4 class="card-title mb-0">
							<i class="fas fa-user me-2"></i>Mon Profil
						</h4>
					</div>
					<div class="card-body p-4">
						<div class="row">
							<div class="col-md-4 text-center mb-4">
								<div class="bg-primary bg-opacity-10 rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 120px; height: 120px;">
									<span class="text-primary fw-bold h2 mb-0">{{ user.firstName|first }}{{ user.lastName|first }}</span>
								</div>
								<h5 class="mb-1">{{ user.fullName }}</h5>
								<p class="text-muted">{{ user.email }}</p>

								{% for role in user.roles %}
									{% if role != 'ROLE_USER' %}
										<span class="badge bg-warning mb-2">
											{{ role == 'ROLE_ADMIN' ?
												'Administrateur' : role }}
										</span>
									{% endif %}
								{% endfor %}
							</div>

							<div class="col-md-8">
								<h6 class="text-primary mb-3">
									<i class="fas fa-info-circle me-2"></i>Informations personnelles
								</h6>

								<div class="row mb-3">
									<div class="col-sm-4 text-muted">Prénom :</div>
									<div class="col-sm-8">{{ user.firstName }}</div>
								</div>

								<div class="row mb-3">
									<div class="col-sm-4 text-muted">Nom :</div>
									<div class="col-sm-8">{{ user.lastName }}</div>
								</div>

								<div class="row mb-3">
									<div class="col-sm-4 text-muted">Email :</div>
									<div class="col-sm-8">{{ user.email }}</div>
								</div>

								<div class="row mb-3">
									<div class="col-sm-4 text-muted">Membre depuis :</div>
									<div class="col-sm-8">{{ user.createdAt|date('d/m/Y') }}</div>
								</div>
							</div>
						</div>

						<div class="d-flex gap-2 justify-content-center mt-4 flex-wrap">
							<a href="{{ path('user_profile_edit') }}" class="btn btn-primary">
								<i class="fas fa-edit me-2"></i>Modifier mes informations
							</a>
							<a href="{{ path('user_change_password') }}" class="btn btn-outline-secondary">
								<i class="fas fa-lock me-2"></i>Changer le mot de passe
							</a>
							<a href="{{ path('user_delete_account') }}" class="btn btn-outline-danger">
								<i class="fas fa-trash me-2"></i>Supprimer mon compte
							</a>
						</div>
					</div>
				</div>

				<div class="card border-0 shadow-sm mt-4">
					<div class="card-header bg-white">
						<h6 class="card-title mb-0">
							<i class="fas fa-chart-bar me-2 text-primary"></i>Mes statistiques
						</h6>
					</div>
					<div class="card-body">
						<div class="row text-center">
							<div class="col-6 mb-3">
								<div class="border-end">
									<h4 class="text-primary mb-1">{{ user.projects|length }}</h4>
									<small class="text-muted">Projet(s) créé(s)</small>
								</div>
							</div>
							<div class="col-6 mb-3">
								<div class="border-end">
									<h4 class="text-info mb-1">{{ user.collaboratingProjects|length }}</h4>
									<small class="text-muted">Projet(s) collaboratif(s)</small>
								</div>
							</div>
							<div class="col-6 mb-3">
								<div class="border-end">
									<h4 class="text-warning mb-1">{{ user.assignedTasksCount }}</h4>
									<small class="text-muted">Tâche(s) assignée(s)</small>
								</div>
							</div>
							<div class="col-6 mb-3">
								<h4 class="text-success mb-1">{{ user.completedAssignedTasksCount }}</h4>
								<small class="text-muted">Tâche(s) terminée(s)</small>
							</div>
						</div>
					</div>
				</div>

				{% if user.collaboratingProjects|length > 0 %}
					<div class="card border-0 shadow-sm mt-4">
						<div class="card-header bg-light">
							<h6 class="card-title mb-0">
								<i class="fas fa-users me-2 text-primary"></i>Mes projets collaboratifs
							</h6>
						</div>
						<div class="card-body">
							<div class="row">
								{% for project in user.collaboratingProjects %}
									<div class="col-md-6 mb-3">
										<div class="card border">
											<div class="card-body p-3">
												<h6 class="card-title mb-2">
													<a href="{{ path('project_show',
														{id: project.id}) }}" class="text-decoration-none">
														<i class="fas fa-folder me-1"></i>{{ project.title }}
													</a>
												</h6>
												<div class="small text-muted mb-2">
													<i class="fas fa-user me-1"></i>Propriétaire : {{ project.owner.fullName }}
												</div>
												<div class="d-flex justify-content-between align-items-center">
													<small class="text-muted">
														<i class="fas fa-tasks me-1"></i>
														{{ user.assignedTasksInProject(project)|length }} tâche(s) assignée(s)
													</small>
												</div>
											</div>
										</div>
									</div>
								{% endfor %}
							</div>
						</div>
					</div>
				{% endif %}

				{% if user.hasOverdueTasks %}
					<div class="card border-0 shadow-sm mt-4 border-warning">
						<div class="card-header bg-warning bg-opacity-10">
							<h6 class="card-title mb-0 text-warning">
								<i class="fas fa-exclamation-triangle me-2"></i>Attention : Tâches en retard
							</h6>
						</div>
						<div class="card-body">
							<p class="text-muted mb-3">
								Vous avez {{ user.overdueTasks|length }} tâche(s) en retard qui nécessite(nt) votre attention.
							</p>
							<div class="d-flex justify-content-between align-items-center">
								<small class="text-muted">N'hésitez pas à mettre à jour vos échéances</small>
								<a href="{{ path('task_index') }}" class="btn btn-warning btn-sm">
									<i class="fas fa-eye me-1"></i>Voir mes tâches
								</a>
							</div>
						</div>
					</div>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}