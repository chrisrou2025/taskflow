{% extends 'base.html.twig' %}

{% block title %}Changer mon mot de passe - TaskFlow
{% endblock %}

{% block body %}
	<div
		class="container">
		<!-- Header avec breadcrumb -->
		<nav aria-label="breadcrumb" class="mb-4">
			<ol class="breadcrumb">
				<li class="breadcrumb-item">
					<a href="{{ path('app_dashboard') }}" class="text-decoration-none">
						<i class="fas fa-tachometer-alt me-1"></i>Tableau de bord
					</a>
				</li>
				<li class="breadcrumb-item">
					<a href="{{ path('user_profile') }}" class="text-decoration-none">
						Mon Profil
					</a>
				</li>
				<li class="breadcrumb-item active">Changer le mot de passe</li>
			</ol>
		</nav>

		<div class="row justify-content-center">
			<div class="col-md-6 col-lg-5">
				<div class="card border-0 shadow-sm">
					<div class="card-header bg-danger text-white">
						<h4 class="card-title mb-0">
							<i class="fas fa-lock me-2"></i>Changer mon mot de passe
						</h4>
					</div>
					<div class="card-body p-4">
						<div
							class="text-center mb-4">
							<!-- Icône sécurité -->
							<div class="bg-danger bg-opacity-10 rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
								<i class="fas fa-shield-alt text-danger fa-2x"></i>
							</div>
							<p class="text-muted">Pour votre sécurité, saisissez votre mot de passe actuel puis le nouveau</p>
						</div>

						<!-- Conseils de sécurité -->
						<div class="alert alert-info">
							<i class="fas fa-info-circle me-2"></i>
							<strong>Conseils pour un mot de passe sécurisé :</strong>
							<ul class="mb-0 mt-2">
								<li>Au moins 8 caractères</li>
								<li>Mélange de lettres, chiffres et symboles</li>
								<li>Évitez les informations personnelles</li>
							</ul>
						</div>

						<form
							method="post" class="needs-validation" novalidate>
							<!-- Mot de passe actuel -->
							<div class="mb-3">
								<label for="current_password" class="form-label fw-semibold">
									<i class="fas fa-key me-1 text-danger"></i>Mot de passe actuel
								</label>
								<div class="input-group">
									<span class="input-group-text bg-light">
										<i class="fas fa-lock text-muted"></i>
									</span>
									<input type="password" class="form-control" id="current_password" name="current_password" placeholder="Votre mot de passe actuel" required>
									<button class="btn btn-outline-secondary" type="button" onclick="togglePassword('current_password')">
										<i class="fas fa-eye" id="current_password_icon"></i>
									</button>
								</div>
								<div class="form-text">Saisissez votre mot de passe actuel pour confirmer votre identité</div>
							</div>

							<!-- Nouveau mot de passe -->
							<div class="mb-3">
								<label for="new_password" class="form-label fw-semibold">
									<i class="fas fa-plus-circle me-1 text-success"></i>Nouveau mot de passe
								</label>
								<div class="input-group">
									<span class="input-group-text bg-light">
										<i class="fas fa-lock text-muted"></i>
									</span>
									<input type="password" class="form-control" id="new_password" name="new_password" placeholder="Votre nouveau mot de passe" minlength="6" required>
									<button class="btn btn-outline-secondary" type="button" onclick="togglePassword('new_password')">
										<i class="fas fa-eye" id="new_password_icon"></i>
									</button>
								</div>
								<!-- Indicateur de force du mot de passe -->
								<div class="progress mt-2" style="height: 5px;">
									<div id="password_strength" class="progress-bar" style="width: 0%"></div>
								</div>
								<div class="form-text" id="password_help">Minimum 6 caractères requis</div>
							</div>

							<!-- Confirmation du nouveau mot de passe -->
							<div class="mb-4">
								<label for="confirm_password" class="form-label fw-semibold">
									<i class="fas fa-check-circle me-1 text-success"></i>Confirmer le nouveau mot de passe
								</label>
								<div class="input-group">
									<span class="input-group-text bg-light">
										<i class="fas fa-lock text-muted"></i>
									</span>
									<input type="password" class="form-control" id="confirm_password" name="confirm_password" placeholder="Confirmez votre nouveau mot de passe" required>
									<button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirm_password')">
										<i class="fas fa-eye" id="confirm_password_icon"></i>
									</button>
								</div>
								<div class="form-text" id="confirm_help">Les mots de passe doivent être identiques</div>
							</div>

							<!-- Boutons d'action -->
							<div class="d-flex justify-content-between align-items-center">
								<a href="{{ path('user_profile') }}" class="btn btn-outline-secondary">
									<i class="fas fa-arrow-left me-2"></i>Annuler
								</a>
								<button type="submit" class="btn btn-danger btn-lg">
									<i class="fas fa-save me-2"></i>Changer le mot de passe
								</button>
							</div>
						</form>
					</div>
				</div>

				<!-- Informations de sécurité -->
				<div class="card border-0 bg-light mt-4">
					<div class="card-body">
						<h6 class="card-title">
							<i class="fas fa-shield-alt text-success me-2"></i>Sécurité de votre compte
						</h6>
						<div class="row text-center">
							<div class="col-4">
								<i class="fas fa-lock text-primary fa-2x mb-2"></i>
								<p class="small mb-0">Chiffrement</p>
							</div>
							<div class="col-4">
								<i class="fas fa-user-shield text-success fa-2x mb-2"></i>
								<p class="small mb-0">Protection</p>
							</div>
							<div class="col-4">
								<i class="fas fa-eye-slash text-warning fa-2x mb-2"></i>
								<p class="small mb-0">Confidentialité</p>
							</div>
						</div>
					</div>
				</div>

				<!-- Conseils supplémentaires -->
				<div class="card border-0 shadow-sm mt-4">
					<div class="card-header bg-white">
						<h6 class="card-title mb-0">
							<i class="fas fa-lightbulb me-2 text-warning"></i>Conseils de sécurité
						</h6>
					</div>
					<div class="card-body">
						<ul class="mb-0 small">
							<li>Ne partagez jamais votre mot de passe avec personne</li>
							<li>Utilisez un mot de passe unique pour TaskFlow</li>
							<li>Changez votre mot de passe régulièrement</li>
							<li>Déconnectez-vous sur les ordinateurs publics</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>

	<style>
		.input-group-text {
			border-right: none;
			background-color: #f8f9fa !important;
		}

		.input-group .form-control {
			border-left: none;
			border-right: none;
		}

		.input-group .btn {
			border-left: none;
		}

		.input-group .form-control:focus {
			border-color: #86b7fe;
			box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
		}

		.progress-bar {
			transition: width 0.3s ease, background-color 0.3s ease;
		}
	</style>

	<script>
		// Fonction pour afficher/masquer les mots de passe
function togglePassword(fieldId) {
const field = document.getElementById(fieldId);
const icon = document.getElementById(fieldId + '_icon');

if (field.type === 'password') {
field.type = 'text';
icon.classList.remove('fa-eye');
icon.classList.add('fa-eye-slash');
} else {
field.type = 'password';
icon.classList.remove('fa-eye-slash');
icon.classList.add('fa-eye');
}
}

// Indicateur de force du mot de passe
document.addEventListener('DOMContentLoaded', function () {
const newPasswordField = document.getElementById('new_password');
const confirmPasswordField = document.getElementById('confirm_password');
const strengthBar = document.getElementById('password_strength');
const passwordHelp = document.getElementById('password_help');
const confirmHelp = document.getElementById('confirm_help');

newPasswordField.addEventListener('input', function () {
const password = this.value;
let strength = 0;
let message = '';
let color = '';

if (password.length >= 6) 
strength++;


if (password.length >= 8) 
strength++;


if (/[A-Z]/.test(password)) 
strength++;


if (/[a-z]/.test(password)) 
strength++;


if (/[0-9]/.test(password)) 
strength++;


if (/[^A-Za-z0-9]/.test(password)) 
strength++;



const percentage = (strength / 6) * 100;

if (strength < 2) {
color = 'bg-danger';
message = 'Mot de passe faible';
} else if (strength < 4) {
color = 'bg-warning';
message = 'Mot de passe moyen';
} else {
color = 'bg-success';
message = 'Mot de passe fort';
} strengthBar.className = `progress-bar ${color}`;
strengthBar.style.width = percentage + '%';
passwordHelp.textContent = password.length === 0 ? 'Minimum 6 caractères requis' : message;
});

// Vérification de la confirmation du mot de passe
confirmPasswordField.addEventListener('input', function () {
const newPassword = newPasswordField.value;
const confirmPassword = this.value;

if (confirmPassword.length === 0) {
confirmHelp.textContent = 'Les mots de passe doivent être identiques';
confirmHelp.className = 'form-text';
} else if (newPassword === confirmPassword) {
confirmHelp.textContent = 'Les mots de passe correspondent !';
confirmHelp.className = 'form-text text-success';
} else {
confirmHelp.textContent = 'Les mots de passe ne correspondent pas';
confirmHelp.className = 'form-text text-danger';
}
});

// Validation du formulaire
document.querySelector('form').addEventListener('submit', function (e) {
const newPassword = newPasswordField.value;
const confirmPassword = confirmPasswordField.value;

if (newPassword !== confirmPassword) {
e.preventDefault();
alert('Les mots de passe ne correspondent pas.');
return false;
}

if (newPassword.length < 6) {
e.preventDefault();
alert('Le nouveau mot de passe doit contenir au moins 6 caractères.');
return false;
}
});
});
	</script>
{% endblock %}
