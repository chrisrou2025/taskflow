<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>
			{% block title %}TaskFlow - Gestion de tÃ¢ches collaboratives
			{% endblock %}
		</title>
		<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>ðŸ“‹</text></svg>">

		{# Feuilles de style externes #}
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

		{# âœ… Feuille de style locale gÃ©rÃ©e par AssetMapper #}
		<link rel="stylesheet" href="{{ asset('styles/app.css') }}">

		{# Scripts JavaScript gÃ©rÃ©s par AssetMapper #}
		{% block javascripts %}
			{{ importmap('app') }}
		{% endblock %}
	</head>

	<body>
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
			<div class="container-fluid">
				<div class="d-flex d-lg-none navbar-header-mobile">
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
						<span class="navbar-toggler-icon"></span>
					</button>

					<a class="navbar-brand" href="{{ path('app_home') }}">
						ðŸ“‹ TaskFlow
					</a>

					{% if app.user %}
						<div class="navbar-toggler-notifications">
							<button class="notification-bell-btn" type="button" data-bs-toggle="modal" data-bs-target="#notificationModal">
								<span class="notification-icon-wrapper">
									<i class="fas fa-bell"></i>
									<span class="badge bg-danger notification-badge" id="notification-count"></span>
								</span>
							</button>
						</div>
					{% endif %}
				</div>

				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav me-auto">
						<li class="nav-item d-lg-block d-none">
							<a class="navbar-brand" href="{{ path('app_home') }}">
								ðŸ“‹ TaskFlow
							</a>
						</li>

						{% if app.user %}
							<li class="nav-item d-lg-none"><hr class="dropdown-divider"></li>
							<li class="nav-item">
								<a class="nav-link" href="{{ path('app_dashboard') }}">
									<i class="fas fa-tachometer-alt"></i>
									Tableau de bord
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="{{ path('project_index') }}">
									<i class="fas fa-folder"></i>
									Mes Projets
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="{{ path('task_index') }}">
									<i class="fas fa-tasks"></i>
									Mes TÃ¢ches
								</a>
							</li>

							<li class="nav-item d-lg-none"><hr class="dropdown-divider"></li>
							<li class="nav-item d-lg-none">
								<a class="nav-link" href="{{ path('user_profile') }}">
									<i class="fas fa-user-edit"></i>
									Mon Profil
								</a>
							</li>
							{% if is_granted('ROLE_ADMIN') %}
								<li class="nav-item d-lg-none">
									<a class="nav-link" href="{{ path('admin_dashboard') }}">
										<i class="fas fa-cogs"></i>
										Administration
									</a>
								</li>
							{% endif %}
							<li class="nav-item d-lg-none">
								<a class="nav-link" href="{{ path('app_logout') }}">
									<i class="fas fa-sign-out-alt"></i>
									DÃ©connexion
								</a>
							</li>
						{% else %}
							<li class="nav-item d-lg-none"><hr class="dropdown-divider"></li>
							<li class="nav-item d-lg-none">
								<a class="nav-link" href="{{ path('app_login') }}">
									<i class="fas fa-sign-in-alt"></i>
									Connexion
								</a>
							</li>
							<li class="nav-item d-lg-none">
								<a class="nav-link" href="{{ path('app_register') }}">
									<i class="fas fa-user-plus"></i>
									Inscription
								</a>
							</li>
						{% endif %}
					</ul>

					<ul class="navbar-nav align-items-center">
						{% if app.user %}
							<li class="nav-item d-none d-lg-block">
								<a class="nav-link" href="{{ path('user_profile') }}">
									<i class="fas fa-user-edit"></i>
									Mon Profil
								</a>
							</li>
							{% if is_granted('ROLE_ADMIN') %}
								<li class="nav-item d-none d-lg-block">
									<a class="nav-link" href="{{ path('admin_dashboard') }}">
										<i class="fas fa-cogs"></i>
										Administration
									</a>
								</li>
							{% endif %}

							<li class="nav-item dropdown d-none d-lg-block notification-desktop">
								<a class="nav-link" href="#" id="notificationDropdownDesktop" role="button" data-bs-toggle="dropdown" aria-expanded="false">
									<span class="notification-icon-wrapper">
										<i class="fas fa-bell"></i>
										<span class="badge bg-danger notification-badge" id="notification-count-desktop"></span>
									</span>
									Notifications
								</a>
								<ul class="dropdown-menu dropdown-menu-end notification-dropdown" id="notification-list-desktop" aria-labelledby="notificationDropdownDesktop"></ul>
							</li>

							<li class="nav-item d-none d-lg-block">
								<a class="nav-link" href="{{ path('app_logout') }}">
									<i class="fas fa-sign-out-alt"></i>
									DÃ©connexion
								</a>
							</li>
						{% else %}
							<li class="nav-item d-none d-lg-block">
								<a class="nav-link" href="{{ path('app_login') }}">
									<i class="fas fa-sign-in-alt"></i>
									Connexion
								</a>
							</li>
							<li class="nav-item d-none d-lg-block">
								<a class="nav-link" href="{{ path('app_register') }}">
									<i class="fas fa-user-plus"></i>
									Inscription
								</a>
							</li>
						{% endif %}
					</ul>
				</div>
			</div>
		</nav>

		<div class="main-content">
			<div class="container-fluid py-4">
				{% for type, messages in app.flashes %}
					{% for message in messages %}
						<div class="alert alert-{{ type == 'error' ? 'danger' : type }} alert-dismissible fade show" role="alert">
							<i class="fas fa-{{ type == 'success' ? 'check-circle' : (type == 'error' ? 'exclamation-triangle' : 'info-circle') }}"></i>
							{{ message }}
							<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
						</div>
					{% endfor %}
				{% endfor %}

				{% block body %}{% endblock %}
			</div>
		</div>

		<footer class="mt-5 py-4 text-center text-muted">
			<div class="container">
				<div class="row">
					<div class="col-md-6">
						<p>&copy;
							{{ 'now'|date('Y') }}
							TaskFlow - Application de gestion de tÃ¢ches</p>
					</div>
					<div class="col-md-6">
						<div class="d-flex justify-content-center gap-3">
							<a href="{{ path('legal_terms') }}" class="text-muted text-decoration-none">CGU</a>
							<a href="{{ path('legal_privacy') }}" class="text-muted text-decoration-none">ConfidentialitÃ©</a>
							<a href="{{ path('legal_gdpr') }}" class="text-muted text-decoration-none">RGPD</a>
							<a href="{{ path('legal_cookies') }}" class="text-muted text-decoration-none">Cookies</a>
						</div>
					</div>
				</div>
				<small>DÃ©veloppÃ© avec Symfony</small>
			</div>
		</footer>

		{# Modal des notifications pour mobile #}
		{% if app.user %}
			<div class="modal fade" id="notificationModal" tabindex="-1" aria-labelledby="notificationModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-dialog-scrollable">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="notificationModalLabel">
								<i class="fas fa-bell me-2"></i>
								Notifications
							</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
						</div>
						<div class="modal-body" id="notification-list-mobile">
							<div class="text-center py-4">
								<div class="spinner-border text-primary" role="status">
									<span class="visually-hidden">Chargement...</span>
								</div>
								<p class="text-muted mt-2 mb-0">Chargement des notifications...</p>
							</div>
						</div>
						<div class="modal-footer">
							<a href="{{ path('notification_index') }}" class="btn btn-primary w-100">
								<i class="fas fa-list me-2"></i>
								Voir toutes les notifications
							</a>
						</div>
					</div>
				</div>
			</div>
		{% endif %}

		{# Scripts JavaScript externes #}

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

		{% if app.user %}
			{% set notification_config = {
				unreadCountUrl: path('api_notification_unread_count'),
				recentNotificationsUrl: path('api_notification_recent', {limit: 5}),
				notificationIndexUrl: path('notification_index')
			} %}
			<div id="notification-config" data-config="{{ notification_config|json_encode }}"></div>
		{% endif %}
	</body>
</html>
